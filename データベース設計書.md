# データベース設計書

## 目次

1. [ページデータテーブル (`page`)](#ページデータテーブル-page)
2. [ページ多言語テーブル (`page_i18n`)](#ページ多言語テーブル-page_i18n)
3. [ゲーム情報テーブル (`game`)](#ゲーム情報テーブル-game)
4. [ゲーム多言語テーブル (`game_i18n`)](#ゲーム多言語テーブル-game_i18n)
5. [キャラクター情報テーブル (`chara`)](#キャラクター情報テーブル-chara)
6. [キャラクター多言語テーブル (`chara_i18n`)](#キャラクター多言語テーブル-chara_i18n)
7. [ゲームキャラクター中間テーブル (`game_chara_mid`)](#ゲームキャラクター中間テーブル-game_chara_mid)
8. [スタジオメンバーテーブル (`member`)](#スタジオメンバーテーブル-member)
9. [スタジオメンバー多言語テーブル (`member_i18n`)](#スタジオメンバー多言語テーブル-member_i18n)
10. [管理者テーブル (`administrator`)](#管理者テーブル-administrator)
11. [外部キー制約とカスケード削除](#外部キー制約とカスケード削除)
12. [資源テーブルの追加](#資源テーブルの追加)
13. [database作成のSQL](#database作成のSQL)

---

## データベース名

`some_web`

---

## テーブル構造の説明

### ページデータテーブル-page

このテーブルは、ウェブサイトのページに関する情報を格納する

| フィールド名      | データ型            | 説明           |
|-------------|-----------------|--------------|
| id          | bigint unsigned | ページの ID      |
| name        | varchar(16)     | ページ名         |
| category    | varchar(32)     | ページのカテゴリー    |
| img_url     | varchar(255)    | ページの表示画像 URL |
| is_active   | bool            | ページの有効状態     |
| creator_id  | bigint unsigned | 作成者の ID      |
| create_time | timestamp       | 作成日時         |
| updater_id  | bigint unsigned | 更新者の ID      |
| update_time | timestamp       | 更新日時         |

---

### ページ多言語テーブル-page_i18n

このテーブルは、各ページの多言語情報を格納する

| フィールド名       | データ型            | 説明        |
|--------------|-----------------|-----------|
| id           | bigint unsigned | ID        |
| page_id      | bigint unsigned | ページの ID   |
| lang_code    | varchar(8)      | 言語コード     |
| title        | varchar(64)     | ページタイトル   |
| subtitle     | varchar(128)    | ページサブタイトル |
| introduction | varchar(255)    | ページ紹介     |
| creator_id   | bigint unsigned | 作成者の ID   |
| create_time  | timestamp       | 作成日時      |
| updater_id   | bigint unsigned | 更新者の ID   |
| update_time  | timestamp       | 更新日時      |

---

### ゲーム情報テーブル-game

このテーブルは、ゲームの基本情報を格納する

| フィールド名       | データ型            | 説明            |
|--------------|-----------------|---------------|
| id           | bigint unsigned | ゲームの ID       |
| release_date | date            | ゲームのリリース日     |
| download_url | varchar(255)    | ゲームのダウンロードリンク |
| img_url      | varchar(255)    | ゲームの表示画像 URL  |
| is_active    | bool            | ゲームの有効状態      |
| creator_id   | bigint unsigned | 作成者の ID       |
| create_time  | timestamp       | 作成日時          |
| updater_id   | bigint unsigned | 更新者の ID       |
| update_time  | timestamp       | 更新日時          |

---

### ゲーム多言語テーブル-game_i18n

このテーブルは、各ゲームの多言語情報を格納する

| フィールド名         | データ型            | 説明            |
|----------------|-----------------|---------------|
| id             | bigint unsigned | ID            |
| game_id        | bigint unsigned | ゲームの ID       |
| lang_code      | varchar(8)      | 言語コード         |
| name           | varchar(128)    | ゲーム名          |
| category       | varchar(32)     | ゲームのカテゴリー     |
| introduction   | varchar(255)    | ゲーム紹介         |
| description    | varchar(512)    | ゲームの詳細説明      |
| series         | varchar(128)    | ゲームシリーズ       |
| project_type   | varchar(32)     | ゲームのプロジェクトタイプ |
| release_status | varchar(32)     | リリース状態        |
| creator_id     | bigint unsigned | 作成者の ID       |
| create_time    | timestamp       | 作成日時          |
| updater_id     | bigint unsigned | 更新者の ID       |
| update_time    | timestamp       | 更新日時          |

---

### キャラクター情報テーブル-chara

このテーブルは、ゲームキャラクターの基本情報を格納する

| フィールド名      | データ型            | 説明              |
|-------------|-----------------|-----------------|
| id          | bigint unsigned | キャラクターの ID      |
| img_url     | varchar(255)    | キャラクターの表示画像 URL |
| is_active   | bool            | キャラクターの有効状態     |
| creator_id  | bigint unsigned | 作成者の ID         |
| create_time | timestamp       | 作成日時            |
| updater_id  | bigint unsigned | 更新者の ID         |
| update_time | timestamp       | 更新日時            |

---

### キャラクター多言語テーブル-chara_i18n

このテーブルは、各キャラクターの多言語情報を格納する

| フィールド名       | データ型            | 説明         |
|--------------|-----------------|------------|
| id           | bigint unsigned | ID         |
| chara_id     | bigint unsigned | キャラクターの ID |
| lang_code    | varchar(8)      | 言語コード      |
| name         | varchar(64)     | キャラクター名    |
| gender       | varchar(16)     | キャラクターの性別  |
| race         | varchar(32)     | キャラクターの種族  |
| chara_class  | varchar(32)     | キャラクターのクラス |
| introduction | varchar(255)    | キャラクター紹介   |
| creator_id   | bigint unsigned | 作成者の ID    |
| create_time  | timestamp       | 作成日時       |
| updater_id   | bigint unsigned | 更新者の ID    |
| update_time  | timestamp       | 更新日時       |

---

### ゲームキャラクター中間テーブル-game_chara_mid

このテーブルは、ゲームとキャラクターの関連情報を格納する

| フィールド名      | データ型            | 説明                       |
|-------------|-----------------|--------------------------|
| id          | bigint unsigned | ID                       |
| game_id     | bigint unsigned | ゲームの ID                  |
| game_name   | varchar(64)     | ゲーム名（冗長フィールド、基本的に中国語）    |
| chara_id    | bigint unsigned | キャラクターの ID               |
| chara_name  | varchar(64)     | キャラクター名（冗長フィールド、基本的に中国語） |
| is_active   | bool            | 関連が有効かどうか                |
| creator_id  | bigint unsigned | 作成者の ID                  |
| create_time | timestamp       | 作成日時                     |
| updater_id  | bigint unsigned | 更新者の ID                  |
| update_time | timestamp       | 更新日時                     |

---

### スタジオメンバーテーブル-member

このテーブルは、スタジオメンバーの基本情報を格納する

| フィールド名      | データ型            | 説明          |
|-------------|-----------------|-------------|
| id          | bigint unsigned | メンバーの ID    |
| age         | smallint        | 年齢          |
| img_url     | varchar(255)    | メンバー画像の URL |
| is_active   | bool            | メンバーの有効状態   |
| creator_id  | bigint unsigned | 作成者の ID     |
| create_time | timestamp       | 作成日時        |
| updater_id  | bigint unsigned | 更新者の ID     |
| update_time | timestamp       | 更新日時        |

---

### スタジオメンバー多言語テーブル-member_i18n

このテーブルは、各スタジオメンバーの多言語情報を格納する

| フィールド名       | データ型            | 説明       |
|--------------|-----------------|----------|
| id           | bigint unsigned | ID       |
| member_id    | bigint unsigned | メンバーの ID |
| lang_code    | varchar(8)      | 言語コード    |
| name         | varchar(64)     | メンバー名    |
| gender       | varchar(16)     | メンバーの性別  |
| job          | varchar(32)     | メンバーの職業  |
| introduction | varchar(255)    | メンバー紹介   |
| creator_id   | bigint unsigned | 作成者の ID  |
| create_time  | timestamp       | 作成日時     |
| updater_id   | bigint unsigned | 更新者の ID  |
| update_time  | timestamp       | 更新日時     |

---

### 管理者テーブル-administrator

このテーブルは、管理者の基本情報を格納する

| フィールド名       | データ型            | 説明         |
|--------------|-----------------|------------|
| id           | bigint unsigned | 管理者の一意の ID |
| name         | varchar(16)     | 管理者名       |
| gender       | varchar(16)     | 管理者の性別     |
| introduction | varchar(255)    | 管理者紹介      |
| img_url      | varchar(255)    | 管理者画像の URL |
| is_active    | bool            | 管理者の有効状態   |
| created_by   | varchar(32)     | 作成者（手動更新）  |
| create_time  | timestamp       | 作成日時       |
| updated_by   | varchar(32)     | 更新者（手動更新）  |
| update_time  | timestamp       | 更新日時       |

---

## 外部キー制約とカスケード削除

1. `page_i18n`の`page_id`は、`page(id)`を参照し、カスケード削除を行う。
2. `game_i18n`の`game_id`は、`game(id)`を参照し、カスケード削除を行う。
3. `chara_i18n`の`chara_id`は、`chara(id)`を参照し、カスケード削除を行う。
4. `game_chara_mid`の`game_id`は、`game(id)`を参照し、カスケード削除を行う。
5. `game_chara_mid`の`chara_id`は、`chara(id)`を参照し、カスケード削除を行う。

---

## 資源テーブルの追加

1. 各主テーブルに対し、xxx_resource テーブルを追加
2. resource_type 列の値は以下の文字列を参照:
   image、link、main?
3. 各 i18n テーブルの lang_code は 必ず入れる
   (page_i18n には''の場合も処理可能だが、お勧めしない--2025.10.18)<br>
~~4. 各 resource テーブルの res_lang_code は 必ず入れる( page_item_resource は現時点 '' だけを使う、全言語共通資源を意味する--2025.
   11.22)~~<br>
4. 各 resource テーブルの res_lang_code は '' を使えるようになってる  --2025.11.23

---

## database作成のSQL

-- D:/MyProject/pots_web/pots-backend/setup/pots_web_db.sql

-- データベースの作成
drop database if exists pots_web;
create database pots_web;
use pots_web;

-- ページ要素テーブル(item_category と page_item_resource の resource_type
は一致するべき、この列はフロントで分類しやすくなるため作成した)
create table page_item (
id bigint unsigned primary key not null,
page_name varchar(16) not null,
item_category varchar(32) not null,
is_active bool not null default true,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp
);

-- ページ要素多言語テーブル
create table page_item_i18n (
id bigint unsigned primary key not null,
page_item_id bigint unsigned not null,
lang_code varchar(8) not null,
title varchar(64),
subtitle varchar(128),
introduction varchar(255),
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
unique(page_item_id, lang_code),
foreign key (page_item_id) references page_item (id) on delete cascade
);

-- ページ要素資源テーブル(res_lang_code''時に全言語も通用することを意味する)
create table page_item_resource (
id bigint unsigned primary key not null,
page_item_id bigint unsigned,
resource_type varchar(32),
res_lang_code varchar(8) not null,
res_sort_order smallint unsigned,
url varchar(255) not null,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
foreign key (page_item_id) references page_item (id) on delete cascade,
unique (page_item_id,resource_type,res_lang_code,res_sort_order)
);

-- ゲームテーブル(関連する列を除き、物理外部キーは使用せず、論理外部キーを使用すべき)
create table game (
id bigint unsigned primary key not null,
sort_order int unsigned unique default null,
release_date date,
is_active bool not null default true,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp
);

-- ゲーム多言語テーブル
create table game_i18n (
id bigint unsigned primary key not null,
game_id bigint unsigned not null,
lang_code varchar(8) not null,
name varchar(128) not null,
category varchar(32),
introduction varchar(255),
description varchar(512),
series varchar(128),
project_type varchar(32),
release_status varchar(32),
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
unique (game_id,lang_code),
foreign key (game_id) references game (id) on delete cascade
);

-- ゲーム資源テーブル(res_lang_codeは''時に全言語も通用することを意味する)
create table game_resource (
id bigint unsigned primary key not null,
game_id bigint unsigned,
resource_type varchar(32),
res_lang_code varchar(8) not null,
res_sort_order smallint unsigned,
url varchar(255) not null,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
foreign key (game_id) references game (id) on delete cascade,
UNIQUE (game_id, resource_type, res_lang_code,res_sort_order)
);

-- キャラクターテーブル(
game_idは物理外部キーでgameテーブルと関連しない。ゲームを削除する時、キャラも削除されることを避けるため)
create table chara (
id bigint unsigned primary key not null,
sort_order int unsigned default null,
age int unsigned,
is_active bool not null default true,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp
);

-- キャラクター多言語テーブル
create table chara_i18n (
id bigint unsigned primary key not null,
chara_id bigint unsigned not null,
lang_code varchar(8) not null,
name varchar(64) not null,
gender varchar(16),
race varchar(32),
chara_class varchar(32),
introduction varchar(255),
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
unique(chara_id,lang_code),
foreign key (chara_id) references chara(id) on delete cascade
);

-- キャラクター資源テーブル(res_lang_code''時に全言語も通用することを意味する)
create table chara_resource (
id bigint unsigned primary key not null,
chara_id bigint unsigned,
resource_type varchar(32),
res_lang_code varchar(8) not null,
res_sort_order smallint unsigned,
url varchar(255) not null,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
foreign key (chara_id) references chara(id) on delete cascade,
unique(chara_id,resource_type,res_lang_code,res_sort_order)
);

-- ゲームとキャラの中間テーブル(
冗長化したgame_nameとcharacter_nameは見やすくため作成したが、中国語のみ保存する)
create table game_chara_mid (
id bigint unsigned primary key not null,
game_id bigint unsigned,
game_name varchar(64) not null,
chara_id bigint unsigned,
chara_name varchar(64) not null,
is_active bool not null default true,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
unique(game_id,chara_id),
foreign key (game_id) references game(id) on delete cascade,
foreign key (chara_id) references chara(id) on delete cascade
);

-- チームメンバーテーブル
create table team_member (
id bigint unsigned primary key not null,
name varchar(64) not null,
sub_name varchar(64),
age smallint,
is_active bool not null default true,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp
);

-- チームメンバー多言語テーブル
create table team_member_i18n (
id bigint unsigned primary key not null,
team_member_id bigint unsigned not null,
lang_code varchar(8) not null,
gender varchar(16),
job varchar(32),
job_desc varchar(128),
introduction varchar(255),
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
unique(team_member_id,lang_code),
foreign key (team_member_id) references team_member(id) on delete cascade
);

-- チームメンバー資源テーブル(res_lang_codeは''時に全言語も通用することを意味する)
create table team_member_resource (
id bigint unsigned primary key not null,
team_member_id bigint unsigned,
resource_type varchar(32),
res_lang_code varchar(8) not null,
res_sort_order smallint unsigned,
url varchar(255) not null,
creator_id bigint unsigned not null,
create_time timestamp not null default current_timestamp,
updater_id bigint unsigned default null,
update_time timestamp default null on update current_timestamp,
foreign key (team_member_id) references team_member(id) on delete cascade,
unique (team_member_id,resource_type,res_lang_code,res_sort_order)
);

-- 管理者テーブル(
このテーブルは独立して管理し、作成者と更新者は手動で更新する必要があり、変更操作は外部に提供しない)
create table administrator (
id bigint unsigned primary key not null,
name varchar(16) not null unique,
gender varchar(16),
introduction varchar(255),
img_url varchar(255),
is_active bool not null default true,
password_hash varchar(255) not null,
created_by varchar(32) not null,
create_time timestamp not null default current_timestamp,
updated_by varchar(32) default null,
update_time timestamp default null on update current_timestamp
);

-- グッズテーブル（保留）
-- ニューステーブル（保留）

exit;

